<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    

    <body>

        <ui:composition template="/templates/mainTemplate.xhtml">
            <ui:define name="title"> Klient - zakończona sprawa </ui:define> 
            <ui:define name="content">
                 <f:event type="preRenderView" listener="#{clientCaseMB.loadCaseConsultantsDetails()}" />

                <h3> Sprawa numer: #{clientCaseMB.selectedClientCase.idClientCase} </h3>

                <div>
                    <div class="leftInlineBox">
                        <h:form id="leftForm">
                            <h4> DANE SPRAWY </h4>
                            <div class="marginLRT30">        
                               
                                <div class="field"> 
                                    <h:outputText class="label" value="Kwota zobowiązania"/> 
                                    <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.freeResourcesValue + clientCaseMB.selectedClientCase.consolidationValue}" /> 
                                </div>
                                
                                <div class="field"> 
                                    <h:outputText class="label" value="Cel"/> 
                                    <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.goal}" /> 
                                </div>
                                <div class="field"> 
                                    <h:outputText class="label" value="Rodzaj kredytu"/> 
                                    <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.productType.name}" /> 
                                </div>
                                
                                <div class="field">
                                    <h:outputText class="label" value="Wielkość raty"/>
                                    <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.expectedInstalment}" />
                                </div>
                                
                                <div class="field">
                                    <h:outputText class="label" value="Data wystawienia na giełdę"/> 
                                    <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.beginDate}" > 
                                        <f:convertDateTime pattern="dd-MM-yy" timeZone="GMT+2"/>
                                    </h:inputText>
                                </div>
                                
                                <div class="field">
                                    <h:outputText class="label" value="Koniec aukcji"/>  
                                    <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.endDate}" >
                                        <f:convertDateTime pattern="dd-MM-yy" timeZone="GMT+2"/>
                                    </h:inputText>
                                </div>
                                
                                <div class="field">
                                    <h:outputText class="label" value="Notatka"/>  
                                    <h:inputTextarea class="inputWidth fontBlack"  style="resize: none; height: 45px;"  disabled="true" value="#{clientCaseMB.selectedClientCase.note}" />
                                </div>
                            </div>
                            
                            <h:panelGroup rendered="#{!(clientCaseMB.selectedClientCase.consultant eq null)}" >
                            <h4>DANE DORADCY</h4>
                            <div class="marginLRT30">   
                                <div class="field"> <h:outputText class="label" value="Imię"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.consultant.name}" /> </div>
                                <div class="field"> <h:outputText class="label" value="Nazwisko"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{clientCaseMB.selectedClientCase.consultant.lastName}" /> </div>
                                <div class="field"> <h:outputText class="label" value="Telefon"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{(clientCaseMB.selectedClientCase.consultant.addresses.toArray()[0].type == 1) ? clientCaseMB.selectedClientCase.consultant.addresses.toArray()[0].phone : clientCaseMB.selectedClientCase.consultant.addresses.toArray()[1].phone}" /> </div>                                         
                            </div>    
                            </h:panelGroup>
                        </h:form>
                    </div>

                    <div class="rightInlineBox">
                        <h:form>
                        <h:panelGroup rendered="#{clientCaseMB.selectedClientCase.caseStatus.idCaseStatus == 1}" >
                            <h4> DOSTĘPNI DORADCY </h4>
                            <p:dataTable id="consultantsTable" value="#{clientCaseMB.castConsultantSetToArray(clientCaseMB.selectedClientCase.consultants)}" rowKey="#{row}" var="row" emptyMessage="brak zgłoszeń!" selection="#{clientCaseMB.selectedConsultant}" selectionMode="single" >
     
                                <p:ajax event="rowSelect" update="@form" />
                                        
                                <p:column headerText="Nazwisko">  
                                    <h:outputText value="#{row.lastName}" /> 
                                </p:column>  

                                <p:column headerText="Imie">  
                                    <h:outputText value="#{row.name}" /> 
                                </p:column>  

                                <p:column headerText="Doświadczenie">    
                                    <h:outputText value="#{row.expirience}" /> 
                                </p:column>  
                                
                                <p:column headerText="Średnia Ocena">    
                                    <h:outputText value="#{empty row.consultantRatings ? 'brak' : row.consultantRatings.toArray()[0].average}" /> 
                                </p:column>  

                             </p:dataTable>
                             <p:commandButton disabled="#{empty clientCaseMB.selectedConsultant}" styleClass="wideButton greyButton floatR" ajax="false" id="przydziel" value="Przydziel" action="#{clientCaseMB.assignConsultant()}"/>

                        </h:panelGroup>
                        
                            <h:panelGroup rendered="#{clientCaseMB.selectedClientCase.caseStatus.idCaseStatus>=2 &amp;&amp; clientCaseMB.selectedClientCase.consultant!=null}" >    
                                    <div class="marginT50">
                                        <h4> WIADOMOŚCI </h4>
                                    </div>
                                    <p:commandLink styleClass="wideButton greyButton floatR" value="Moje wiadomości" action="#{messagesMB.showMessagesPage(clientCaseMB.selectedClientCase.consultant.user.idUser)}"/>
                        </h:panelGroup>            
                                    
                        <h:panelGroup rendered="#{clientCaseMB.selectedClientCase.caseStatus.idCaseStatus == 9}">
                            <h4> NASTĘPNA RATA </h4>

                            <div style="min-height: 58px;"><h:outputText class="boldItem" value="11-08-2013" /> </div>

                            <h4> PROGNOZOWANY CZAS ZAKOŃCZENIA</h4>    

                            <div style="min-height: 58px;"><h:outputText class="boldItem" value="30-10-2018" /> </div>

                            <h4> HARMONOGRAM SPŁAT </h4>

                            <p:dataTable id="dataTable2" value="#{fakeBean.harmonogram}" var="data" emptyMessage="brak klientów!" 
                                         rowKey="#{data.pozostało}">
                                <p:column headerText="Termin spłaty">  
                                    <h:outputText value="#{data.termin}" /> 
                                </p:column>  

                                <p:column headerText="Kwota">  
                                    <h:outputText value="#{data.kwota2}" /> 
                                </p:column>  

                                <p:column headerText="Pozostało">    
                                    <h:outputText value="#{data.pozostało}" /> 
                                </p:column>  

                                <p:column headerText="Spłacono">  
                                    <h:outputText value="#{data.spłacono}" /> 
                                </p:column>    
                            </p:dataTable>
                            <p:commandLink styleClass="wideButton greyButton floatR" id="viewButton3" value="Dodaj spłatę"  oncomplete="dodaj.show()"/>

                            <p:dialog id="dialog3"  styleClass="dialog"
                                      header="Dodaj spłatę"  widgetVar="dodaj" resizable="tfalse"  
                                      height="160" width="400" showEffect="clip" hideEffect="fold" modal="true">  

                                <div class="dialogFillBox" >
                                    <div class="field"> <h:outputText class="label" value="Kwota spłaty"/>  <h:inputText  /> </div>
                                    <div class="field"> <h:outputText class="label" value="Data spłaty"/>  <h:inputText  /> </div>
                                </div>

                                <div class="przyciskiDol marginT10">                  
                                    <p:commandLink styleClass="wideButton greyButton floatL" style="color: black;" value="Anuluj" type="submit" onclick="dodaj.hide()" /> 
                                    <p:commandLink styleClass="wideButton greenButton floatR" style="color: black;" value="Zatwierdź"   type="submit" onclick="dodaj.hide()" /> 
                                </div>

                            </p:dialog>


                            <h4 style="margin-top: 80px;"> HISTORIA SPŁAT </h4>

                            <p:dataTable id="dataTable3" value="#{fakeBean.splacono}" var="data" emptyMessage="brak klientów!" >

                                <p:column headerText="Data wpłaty">  
                                    <h:outputText value="#{data.termin}" /> 
                                </p:column>  

                                <p:column headerText="Kwota">  
                                    <h:outputText value="#{data.kwota2}" /> 
                                </p:column>  

                                <p:column headerText="Pozostało">    
                                    <h:outputText value="#{data.pozostało}" /> 
                                </p:column>  

                                <p:column headerText="Spłacono">  
                                    <h:outputText value="#{data.spłacono}" /> 
                                </p:column>      
                            </p:dataTable>
                            
                            <p:commandLink styleClass="wideButton greyButton floatR" value="Oceń doradcę" rendered="#{caseRatingMB.isNotRated()}" action="#{caseRatingMB.showRatePage()}"> 
                                
                            </p:commandLink> 
                            
                        </h:panelGroup>
                       </h:form>
                    </div>
                </div>
                <div style="width: 100%; height: 2px;" ></div>
            </ui:define>

        </ui:composition>
    </body>
</html>
