<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:comp="http://java.sun.com/jsf/composite/components">

    <body>

        <ui:composition template="/templates/mainTemplate.xhtml">
            <ui:define name="title"> Doradca - szczegóły sprawy </ui:define> 
            <ui:define name="content">
                <script>  
                    function changeLabel() {
                                if ($("#finishedDialog\\:interestRateType_input").val() == 1)
                                    {
                                        $("#finishedDialog\\:interestRateLabel").text('Część kapitałowa raty');                         
                                    }
                                else
                                    {
                                       $("#finishedDialog\\:interestRateLabel").text('Wysokość raty');      
                                    }
                    } 
                </script>
                
                
                <f:metadata>         
                    <f:viewParam name="clientCaseId" value="#{caseViewMB.clientCaseId}" />
                </f:metadata>
                <f:event type="preRenderView" listener="#{caseViewMB.loadCaseClientsDetails()}" />
                <h:form id="titleForm">
                    <h3> Sprawa numer: #{caseViewMB.selectedClientCase.idClientCase} (#{caseViewMB.selectedClientCase.caseStatus.name}) </h3>
                </h:form>
                <comp:buySubscriptionDialog returnOnCancel="false" widgetName="subsDialog" />              
                    <div style="min-height: 160px">
                        <div class="leftInlineBox">
                            <h:form id="leftForm">
                                <h4> DANE KLIENTA </h4>
                                <div class="marginLRT30">        
                                    <div class="field"> <h:outputText class="label" value="Imię"/>  <h:inputText rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus > 1}" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.client.name}" /> </div>
                                    <div class="field"> <h:outputText class="label" value="Nazwisko"/>  <h:inputText rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus > 1}" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.client.lastName}" /> </div>
                                    <div class="field"> <h:outputText class="label" value="PESEL"/>  <h:inputText rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus > 1}" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.client.pesel}" /> </div>
                                    <div class="field"> <h:outputText class="label" value="Data Urodzenia"/>  <h:inputText rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus > 1}" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.client.birthDate}" /> </div>
                                    <div class="field"> <h:outputText class="label" value="Telefon"/>  <h:inputText rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus > 1}" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.client.addresses.toArray()[0].phone}" /> </div>
                                </div>

                                <h4> DANE O ZATRUDNIENIU </h4>
                                <div class="marginTB20" >   
                                    <p:dataTable style="clear:both" id="table" value="#{caseViewMB.selectedCaseIncomeTable}" var="data" emptyMessage="Klient nie zdefiniował żadnych informacji." >

                                        <p:column headerText="Rodzaj">  
                                            <h:outputText  value="#{data.employmentType}" />
                                        </p:column>  

                                        <p:column headerText="Branża"> 
                                            <h:outputText value="#{data.branch}" />
                                        </p:column>  

                                        <p:column headerText="Dochód netto">  
                                            <h:outputText value="#{data.incomeNetto}" />
                                        </p:column>  

                                    </p:dataTable>

                                </div>    

                                <h4> DANE SPRAWY </h4>
                                <div class="marginLRT30">        
                                    <div class="field"> 
                                        <h:outputText class="label" value="Data rozpoczęcia"/>  
                                        <h:inputText class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.beginDate}" > 
                                            <f:convertDateTime type="date"  pattern="dd-MM-yyyy" />
                                        </h:inputText>
                                    </div>

                                    <div class="field"> <h:outputText class="label" value="Cel"/>  <h:inputText id="goal" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.goal}" /> </div>
                                    <div class="field">
                                         <h:outputText class="label" value="Notatka"/>  
                                         <h:inputTextarea class="inputWidth fontBlack"  style="resize: none; height: 45px;" rows="3" cols="30" disabled="true" value="#{caseViewMB.selectedClientCase.note}" />
                                    </div>
                                    <div class="field"> <h:outputText class="label" value="Rodzaj kredytu"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.productType.name}" /> </div>
                                    <h:panelGroup rendered ="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus lt 8}" >
                                        <div class="field"> <h:outputText class="label" value="Kwota wolne środki"/>  <h:inputText id="freeResourcesValue" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.freeResourcesValue}" /> </div>
                                        <div class="field"> <h:outputText class="label" value="Kwota konsolidacji"/>  <h:inputText id="consolidationValue" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.consolidationValue}" /> </div>
                                        <div class="field"> <h:outputText class="label" value="Pożądana rata"/>  <h:inputText id="expectedInstalment" class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.expectedInstalment}" /> </div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered ="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus == 9}">
                                        <div class="field"> <h:outputText class="label" value="Otrzymana kwota"/>  <h:inputText  class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.consolidationValue}" /> </div>
                                        <div class="field"> <h:outputText class="label" value="Wielkość raty"/>  <h:inputText  class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.expectedInstalment}" /> </div>
                                        <div class="field"> <h:outputText class="label" value="Typ oprocentowania"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{(caseViewMB.selectedClientCase.interestRateType == 0) ? 'stałe' : 'malejące'}" /> </div>
                                        <div class="field"> <h:outputText class="label" value="Oprocentowanie"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.interestRate} %" /> </div>
                                        <div class="field"> <h:outputText class="label" value="Data otrzymania kredytu"/>  <h:inputText class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.receiveCreditDate}" /> </div>
                                    </h:panelGroup>
                                 
                                
                                </div>

                            </h:form>
                        </div>

                        <div class="rightInlineBox">
                            <h:form id="rightColumn">
                                <h:panelGroup rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus == 1}" >
                                    <h:panelGroup rendered="#{!clientCaseMB.doesAppliedToCase(loginMB.consultant, caseViewMB.selectedClientCase)}" >
                                        <h4> WYŚLIJ SWOJE ZGŁOSZENIE </h4>
                                        <div class="solidText"> 
                                            Sprawa wydaje Ci się interesująca? Myślisz, że jesteś w stanie ją wygrać? <br /> Zgłoś się teraz!
                                        </div>
                                        <div style="min-height: 50px"></div>
                                        <p:commandButton rendered="#{loginMB.returnConsultantAccessRights() > settings.free}" id="apply" styleClass="topMenuButton greyButton wideButton" value="Zgłoś się!" action="#{clientCaseMB.applyToCase(caseViewMB.selectedClientCase)}" oncomplete="confirmed.show();" /> 
                                        <p:commandButton rendered="#{loginMB.returnConsultantAccessRights() == settings.free}" disabled="#{empty consultantMainPageMB.selectedLastCase}" styleClass="topMenuButton greyButton wideButton" value="Zgłoś się!" type="button" onclick="subsDialog.show();" />
                   
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{clientCaseMB.doesAppliedToCase(loginMB.consultant, caseViewMB.selectedClientCase)}" >
                                        <h4> WYCOFAJ ZGŁOSZENIE </h4>
                                        <div class="solidText"> 
                                            Klient jeszcze nie zaakceptował Ciebie jako swojego doradcy. <br /> W dalszym ciągu możesz wycofać sprawę. 
                                        </div>
                                        <div style="min-height: 50px"></div>
                                        <p:commandButton type="button" styleClass="topMenuButton redX wideButton" value="Usuń" onclick="revokeApp.show();" >

                                        </p:commandButton>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{!clientCaseMB.doesConsultantObserveCase(loginMB.consultant, caseViewMB.selectedClientCase)}" >
                                        <div style="min-height: 50px"></div>
                                        <h4> OBSERWUJ SPRAWĘ </h4>
                                        <div class="solidText"> 
                                            Jeszcze się zastanawiasz? <br /> Dodaj sprawę do obserwowanych spraw, dzięki temu szybko będziesz mógł ją znaleźć jeśli zdecydujesz się zgłosić. 
                                        </div>
                                        <div style="min-height: 50px"></div>
                                        <p:commandButton rendered="#{loginMB.returnConsultantAccessRights() > settings.free}" styleClass="topMenuButton greyButton wideButton" value="Obserwuj" action="#{clientCaseMB.traceCase(caseViewMB.selectedClientCase)}" oncomplete="confirmedObserved.show();" />
                                        <p:commandButton rendered="#{loginMB.returnConsultantAccessRights() == settings.free}" disabled="#{empty consultantMainPageMB.selectedLastCase}" styleClass="topMenuButton greyButton wideButton" value="Obserwuj" type="button" onclick="subsDialog.show();" />
                   
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{clientCaseMB.doesConsultantObserveCase(loginMB.consultant, caseViewMB.selectedClientCase)}" >
                                        <div style="min-height: 50px"></div>
                                        <h4> ANULUJ OBSERWOWANIE</h4>
                                        <div class="solidText"> 
                                            Ta sprawa Cię dłużej nie interesuje? Usuń ją z listy obserwowanych spraw!
                                        </div>
                                        <div style="min-height: 50px"></div>
                                        <p:commandButton styleClass="topMenuButton redX wideButton" value="Usuń" oncomplete="revokeObs.show();" />
                                    </h:panelGroup>
                                </h:panelGroup>
                                    <h:panelGroup style="color: red" rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus == 1 and !(caseViewMB.selectedClientCase.consultant eq null) and (loginMB.consultant.idConsultant == caseViewMB.selectedClientCase.consultant.idConsultant)}" >
                                        <h4> PODEJMIJ DECYZJĘ </h4>
                                        <div class="solidText"> 
                                            Dana sprawa jest sprawą Premium i klient chce właśnie Ciebie do prowadzenia sprawy. <br /><br /> Podejmij decyzję teraz. Pamiętaj odrzucenie sprawy premium skutkuje w utracie rankingu. 
                                        </div>
                                        <div style="min-height: 30px"></div>
                                        <p:commandButton  styleClass="floatR redX wideButton" update="@this" style="margin-top: 17px !important" value="Nie akceptuję"  oncomplete="revokePremiumDialog.show();"/> 
                                        <p:commandButton  styleClass="floatR greyButton wideButton" update="@this" style="margin-top: 17px !important" value="Akceptuję"  oncomplete="acceptPremiumDialog.show();" />     
                                    </h:panelGroup>
                                <h:panelGroup rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus > 1}" >
                                    

                                    
                                    
                                   <h4> DOKUMENTY KLIENTA </h4>
                                   <div>
                                       <h:panelGrid columns="4">
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.bik==null}" target="_blank" action="#{ fileDownloadMB.load8() }">
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.bik!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.bik==null}"  style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText  value="BIK"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.idCard==null}" target="_blank" action="#{ fileDownloadMB.load1() }">
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.idCard!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" /> 
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.idCard==null}" style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText value="Dowód tożsamości"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.incomeStatement==null}" target="_blank" action="#{ fileDownloadMB.load2() }"> 
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.incomeStatement!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" /> 
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.incomeStatement==null}" style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText value="Zaświadczenie o zarobkach"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.deathCertificate==null}" target="_blank" action="#{ fileDownloadMB.load3() }">
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.deathCertificate!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.deathCertificate==null}" style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText value="Akt zgonu współmałżonka"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.mariageSettlement==null}" target="_blank" action="#{ fileDownloadMB.load4() }">
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.mariageSettlement!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" /> 
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.mariageSettlement==null}" style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText value="Intercyza"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.divorceAct==null}" target="_blank" action="#{ fileDownloadMB.load5() }"> 
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.divorceAct!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.divorceAct==null}" style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText value="Akt rozwodu"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.separationAct==null}" target="_blank" action="#{ fileDownloadMB.load6() }"> 
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.separationAct!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.separationAct==null}" style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText  value="Akt separacji"/>
                                           
                                           <h:commandLink disabled="#{fileDownloadMB.requiredDocuments.titleDeed==null}" target="_blank" action="#{ fileDownloadMB.load7() }">
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.titleDeed!=null}" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                               <h:graphicImage rendered="#{fileDownloadMB.requiredDocuments.titleDeed==null}"  style="opacity: 0.2;" alt="could not be found."  value="/resources/icons/Document-icon.png" />
                                           </h:commandLink>
                                           <h:outputText  value="Akt własności"/>
                                       </h:panelGrid> 
                                   </div>
                                   
                                   <div>
                                       <h4> ANALIZA WYCIĄGÓW BANKOWYCH </h4>
                                         <h:commandButton class="floatR wideButton" value="Analiza" action="#{caseViewMB.toAccountAnalysis()}" />
                                   </div>
                                   
                                  <h:panelGroup rendered="#{fileDownloadMB.requiredDocuments.bik!=null}" >
                                       <h4> Analiza raportu BIK </h4>
                                       <h:panelGroup rendered="#{fileDownloadMB.requiredDocuments.bikStatus==null}" >
                                           <h:outputText value="Bik nie był jeszcze analizowany."/>
                                           <p:commandButton styleClass="floatR greyButton" value="Analizuj BIK" ajax="true" update=":rightColumn" action="#{fileDownloadMB.parseBik(caseViewMB.selectedClientCase.client.idClient)}"></p:commandButton>    
                                       </h:panelGroup>
                                       <h:panelGroup rendered="#{fileDownloadMB.requiredDocuments.bikStatus==1}" >
                                           <h:outputText value="Bik w trakcie analizowania. Analiza może trwać do 5 minut."/>
                                       </h:panelGroup>
                                       <h:panelGroup rendered="#{fileDownloadMB.requiredDocuments.bikStatus==3}" >
                                           <h:outputText value="Bik klienta jest niepoprawnym plikiem lub hasło do pliku jest błędne! Poproś klienta o wgranie nowego raportu BIK."/>
                                       </h:panelGroup>
                                       <h:panelGroup rendered="#{fileDownloadMB.requiredDocuments.bikStatus==4}" >
                                           <h:outputText value="Bik pomyślnie przetworzony"/>
                                           <p:commandButton styleClass="floatR greyButton" value="Zobacz wyniki" action="#{bikMB.showBik(caseViewMB.selectedClientCase.client.idClient)}"></p:commandButton>
                                       </h:panelGroup>           
                                   </h:panelGroup>    
                                   
                                    
                                   <h4> USTAW STATUS SPRAWY </h4>
                                   <div class="solidText"> 
                                         Zaktualizuj bieżący status sprawy dzięki czemu klient będzie widział, że sprawa postępuje:
                                   </div> 
                                   
                                   <p:selectOneMenu styleClass="floatR marginTB20" style="width: 250px; " value="#{caseViewMB.caseStatusID}" >
                                       <f:selectItems value="#{clientCaseMB.statusModel}" var="entry" itemLabel="#{entry.name}" itemValue="#{entry.idCaseStatus}" /> 
                                   </p:selectOneMenu>
                                   <p:commandButton styleClass="floatR greyButton wideButton" style="clear:both" value="Zmień" action="#{caseViewMB.changeCaseStatus()}"  />
                                   <div style="min-height: 80px;"> </div>
                                   <p:dialog header="Informacja" id="statusChanged" widgetVar="statusChange" resizable="false" closable="false" hideEffect="fade" showEffect="fade" >
                                       <div class="fontGrey"> Status sprawy został zaktualizowany </div>
                                   
                                       <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" type="button" value="Kontynuuj" onclick="statusChange.hide()"  >
                                           <f:ajax  execute="@this" render="@all" /> 
                                       </h:commandButton>
                                   
                                   </p:dialog>
                                   


                                   
                                   <h:panelGroup id="currentOffer" rendered="#{(caseViewMB.selectedClientCase.caseStatus.idCaseStatus >= 3) and !(caseViewMB.selectedClientCase.productDetails == null)}" >   
                                       <h4> AKTUALNIE PRZYPISANA OFERTA </h4>
                                       <div class="solidText">
                                           Tutaj znajduje się aktualnie przypisana przed doradcę oferta. 
                                       </div>
                                       <div style="min-height: 30px;"></div>
                                           
                                           
                                       <p:commandButton id="actualDetailsButton" update="detailsDialog"  styleClass="marginTB20 floatR greyButton wideButton" value="Szczegóły" action="#{caseViewMB.showActualAssignedProductConsultantView()}" oncomplete="productDetails.show()" />
                                           
                                   </h:panelGroup>
                                   
                                   <h:panelGroup rendered="#{(caseViewMB.selectedClientCase.caseStatus.idCaseStatus != 9) }" >
                                   
                                   <div style="clear:both">
                                        <h4> WYSZUKAJ NAJLEPSZĄ OFERTĘ </h4>
                                        <div class="solidText"> 
                                            Ta funkcja pozwoli Ci wybrać najlepszą ofertę jaką możesz zaproponować klientowi
                                        </div>  
                                        <div style="min-height: 80px"> <p:commandButton styleClass="marginTB20 floatR greyButton wideButton" update ="offers" value="Znajdź" action="#{caseViewMB.findBestProduct()}" oncomplete=""/> </div>
                                    </div>
                                   
                                   <p:dialog header="Informacja" id="noProductsDialog" widgetVar="emptyProducts" resizable="false" closable="false" hideEffect="fade" showEffect="fade" >
                                       <div class="fontGrey"> Nie znaleziono żadnych produktów odpowiadających tej sprawie.</div>
                                   
                                       <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" type="button" value="Kontynuuj" onclick="emptyProducts.hide()"  >
                                           <f:ajax  execute="@this" render="@this" /> 
                                       </h:commandButton>
                                   </p:dialog>
                                   
                                       
                                       <p:dataTable id="offers" value="#{caseViewMB.products}" var="row" rowIndexVar="rowIndex" rowKey="#{row}" selection="#{caseViewMB.selectedProduct}" emptyMessage="Nie ma żadnych spraw" selectionMode="single" >
                                       <p:ajax event="rowSelect" update="offers :rightColumn:detailsButton :rightColumn:assignButton" />
                                       
                                        <p:column headerText="Nazwa instytucji">  
                                            <h:outputText value="#{caseViewMB.fetchTopProductForProductDetails(row).institution.name}" />
                                        </p:column>  

                                        <p:column headerText="Nazwa oferty">  
                                            <h:outputText value="#{caseViewMB.fetchTopProductForProductDetails(row).productName}" />
                                        </p:column>  

                                        <p:column headerText="Trafność">    
                                            <h:outputText value="#{caseViewMB.sortedProductValues.get(rowIndex)*100/4}  %" />
                                        </p:column>  
                                    </p:dataTable>
                                   <p:commandButton id="assignButton" disabled="#{empty caseViewMB.selectedProduct}" update="offers detailsDialog :titleForm :rightColumn:currentOffer"  styleClass="marginTB20 floatR greyButton wideButton" value="Przypisz ofertę" action="#{caseViewMB.assignProduct(caseViewMB.selectedProduct)}" oncomplete="assignProducts.show()" />
                                   <p:commandButton id="detailsButton" disabled="#{empty caseViewMB.selectedProduct}" update="offers detailsDialog"  styleClass="marginTB20 floatR greyButton wideButton" value="Szczegóły" action="#{caseViewMB.fetchProductTreeForSelectedProduct(caseViewMB.selectedProduct)}" oncomplete="productDetails.show()" />
                                   </h:panelGroup>
                                   <p:dialog header="Informacja" id="assignedDialog" widgetVar="assignProducts" resizable="false" closable="false" hideEffect="fade" showEffect="fade" >
                                       <div class="fontGrey"> Oferta została przypisana do sprawy.</div>
                                   
                                       <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" type="button" value="Kontynuuj" onclick="assignProducts.hide()"  >
                                           <f:ajax  execute="@this" render="@this" /> 
                                       </h:commandButton>
                                   </p:dialog>
                                   
                                   <p:dialog  showHeader="false" id="detailsDialog" widgetVar="productDetails" width="850" height="500" closable="true" resizable="false" dynamic="true" hideEffect="fade" showEffect="fade" >
                                       <h4>#{caseViewMB.fetchTopProductForProductDetails(caseViewMB.selectedProduct).institution.name} </h4>
                                       
                                       <ui:repeat varStatus="current" value="#{caseViewMB.productTree}" var="node" >       
                                           <h:panelGroup rendered="#{current.index == 0}" > <h3>#{node.productName}</h3> </h:panelGroup>
                                           <h:panelGroup rendered="#{current.index > 0}" > <h4>#{node.productName}</h4> </h:panelGroup>
                                       </ui:repeat>
                                       
                                       
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel" value="Typ kredytu:  " />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.productType.name}" />                                                                
                                       </div>
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel"  value="Kredyt dla: " />
                                            <h:inputText  style="width: 55.9%" disabled="true" value="#{caseViewMB.selectedProduct.employmentType.name}" />                                                                
                                       </div>
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel"  value="Kwota: " />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.amountBruttoMin}" />
                                            <h:outputText class="marginLR20" value="---" />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.amountBruttoMax}" />                                                                
                                       </div>
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel"  value="Okres kredytowania: " />

                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.loanTimeMin}" />
                                            <h:outputText class="marginLR20" value="---" />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.loanTimeMax}" />                                                                
                                       </div>
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel"  value="Wiek kredytobiorcy: " />
                                            
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.clientAgeMin}" />
                                            <h:outputText class="marginLR20" value="---" />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.clientAgeMax}" />                                                                
                                       </div>
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel"  value="Ilość współkredytobiorców: " />
                                          
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.partnersNumberMin}" />
                                            <h:outputText class="marginLR20" value="---" />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.partnersNumberMax}" />                                                                
                                       </div>
                                       <div class="pdetailsItem">
                                            <h:outputText class="pdetailsLabel"  value="Okres otrzymywania dochodu: " />
                                            
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.oodwmMin}" />
                                            <h:outputText class="marginLR20" value="---" />
                                            <h:inputText disabled="true" value="#{caseViewMB.selectedProduct.oodwmMax}" />                                                                
                                       </div>
                                       <h:panelGroup rendered="#{caseViewMB.selectedProduct.recomendation}" >
                                            <div class="pdetailsItem">
                                                <h:outputText class="pdetailsLabel"  value="Rekomendacja: " /> <br />
                                                <h:inputTextarea class="pdetailsArea" rows="6" cols="80" disabled="true" value="#{caseViewMB.selectedProduct.recomendationDetails}" />
                                            </div>
                                       </h:panelGroup>
                                       <div class="pdetailsItem">
                                               <h:outputText class="pdetailsLabel"  value="Wymagane dokumenty: " />
                                               <h:inputTextarea  style="margin-bottom: 30px" class="pdetailsArea" rows="6" cols="80" disabled="true" value="#{caseViewMB.selectedProduct.requiredDocuments}" />
                                       </div>
                                       <div style="clear:both; margin-top: 30px;">
                                       <p:dataTable value="#{caseViewMB.documents}" selection="#{caseViewMB.selectedDocument}"  rowKey="#{row.idDocument}" rowIndexVar="rowNumber"  var="row" emptyMessage="Brak dokumentów" selectionMode="single" >
 
                                      
                                           
                                                <p:column headerText="Opis"> 
                                                    <h:outputText  value="#{row.description}"/>
                                                </p:column>  

                                               <p:column headerText="Plik"> 
                                                   <h:outputText  value="#{row.fileName}"/>
                                                </p:column>   
                                           
                                                <p:column headerText="" >
                                                    <h:commandLink target="_blank" value="Pobierz" action="#{ fileDownloadMB.loadInstitutionFile(row.institution.idInstitution, row.fileName) }" />
                                                </p:column>          
                                       </p:dataTable>
                                       </div>
                                       <h:commandButton  styleClass="floatR wideButton marginTB20" style="clear:both;" type="button" value="Kontynuuj" onclick="productDetails.hide()"  >
                                           <f:ajax  execute="@this" render="@this" /> 
                                       </h:commandButton>
                                       
                                   </p:dialog>
                                   
                                </h:panelGroup>
                                <h:panelGroup rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus >= 2 &amp;&amp; caseViewMB.selectedClientCase.consultant!=null}" >    
                                    <div class="marginT50">
                                        <h4> WIADOMOŚCI </h4>
                                    </div>
                                    <p:commandLink styleClass="wideButton greyButton floatR" value="Moje wiadomości" action="#{messagesMB.toConversation(caseViewMB.selectedClientCase.client.user.idUser)}"/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{caseViewMB.selectedClientCase.caseStatus.idCaseStatus == 9}" >


                                    <div class="marginT50">
                                        <h4> OCENA SPRAWY </h4>
                                    </div>

                                    <div class="field">
                                        <h:outputText class="label" value="Opinia klienta"/>
                                        <h:inputTextarea class="inputWidth fontBlack" style="resize: none; width: 270px; height: 60px" disabled="true" value="#{caseViewMB.selectedClientCase.caseRating.comment}" />
                                    </div>
                                    <div class="field">
                                        <h:outputText class="label" value="Opinię dodano"/>
                                        <h:inputText class="inputWidth fontBlack" disabled="true" value="#{caseViewMB.selectedClientCase.caseRating.commentDate}" />
                                    </div>

                                    <div class="marginT50"></div>

                                    <h:outputText class="label" value="Kontakt"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.contact}" disabled="true"/>

                                    <h:outputText class="label" value="Kultura"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.culture}" disabled="true"/>

                                    <h:outputText class="label" value="Kompetencje"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.competence}" disabled="true"/>

                                    <h:outputText class="label" value="Czas"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.punctuality}" disabled="true"/>

                                    <h:outputText class="label" value="Rzetelność"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.reliability}" disabled="true"/>

                                    <h:outputText class="label" value="Szacunek"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.respect}" disabled="true"/>

                                    <h:outputText class="label" value="Trud"/> 
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.difficulty}" disabled="true"/>

                                    <h:outputText class="label" value="Zaufanie"/>
                                    <p:rating value="#{caseViewMB.selectedClientCase.caseRating.trust}" disabled="true"/>

                                </h:panelGroup>
                            </h:form>
                        </div>
                    </div>
                        
                        
                <p:dialog header="Sprawa zakończona" id="finishedCase" dynamic="true" widgetVar="fillFinishedData" resizable="false" closable="false" hideEffect="fade" showEffect="fade" >
                        <h:form id="finishedDialog">
                            <div class="marginT10"> 
                                <h:outputText class="dialogLabel" value="Przyznana kwota"/>
                                <h:inputText required="true" id="consolidation" class="floatR marginT10"  style="width: 205px" value="#{caseViewMB.selectedClientCase.consolidationValue}" >
                                    <f:convertNumber maxFractionDigits="2" />>
                                </h:inputText>
                                <h:message for="consolidation" errorClass="invalid" id="consolidationMessage" />
                            </div>   


                            <div class="marginT10"> 
                                <h:outputText class="dialogLabel" value="Data otrzymania kredytu:"/>
                                <p:calendar validator="#{caseViewMB.validateFinishedDates}" binding="#{receive}" required="true" id="receiveDate" pattern="dd-MM-yyyy" navigator="true" styleClass="floatR marginT10"  value="#{caseViewMB.selectedClientCase.receiveCreditDate}"> 
                                    <f:convertDateTime type="date" pattern="dd-MM-yyyy"  />
                                    <f:attribute name="beginDateValue" value="#{begin}" />
                                </p:calendar>
                                <h:message for="receiveDate" errorClass="invalid" id="receiveDateMessage" />
                            </div>
                            

                            <div class="marginT10"> 
                                <h:outputText class="dialogLabel" value="Data pierwszej raty:"/>
                                <p:calendar validator="#{caseViewMB.validateFinishedDates}" binding="#{begin}" required="true" id="beginDate" pattern="dd-MM-yyyy" navigator="true" styleClass="floatR marginT10"  value="#{caseViewMB.selectedClientCase.beginPaymentDate}"> 
                                    <f:convertDateTime type="date" pattern="dd-MM-yyyy" />
                                    <f:attribute name="receiveDateValue" value="#{receive}" />
                                </p:calendar>
                                <h:message for="beginDate" errorClass="invalid" id="beginDateMessage" />
                            </div>
                            
          

                          
                            
                            <div class="marginT10"> 
                                <h:outputText class="dialogLabel" value="Oprocentowanie"/>
                                <h:inputText required="true" id="interestRate" class="floatR marginT10"  style="width: 205px" value="#{caseViewMB.selectedClientCase.interestRate}" >
                                    <f:convertNumber maxFractionDigits="2"  />
                                    <f:validateDoubleRange minimum="0.00" maximum="100.0" />
                                </h:inputText>
                                <h:message for="interestRate" errorClass="invalid" id="interestRateMessage" />
                            </div>
                            
                            
                            <div class="marginT10"> 
                                <h:outputText class="dialogLabel" value="Typ oprocentowania"/> 
                                <p:selectOneMenu onchange="changeLabel();" id="interestRateType" styleClass="marginT10" style="width: 213px; margin-left: 31px; float:right;" value="#{caseViewMB.selectedClientCase.interestRateType}">  
                                    <f:selectItem itemLabel="Stałe" itemValue="#{0}" />
                                    <f:selectItem itemLabel="Malejące" itemValue="#{1}" />
                                </p:selectOneMenu>  
                            </div>
                                   
                            <div class="marginT10"> 
                              
                                <h:outputText id="interestRateLabel" class="dialogLabel" value="Wysokość raty"/>
                                 
                                <h:inputText required="true" id="instalment" class="floatR marginT10"  style="width: 205px" value="#{caseViewMB.selectedClientCase.expectedInstalment}" >
                                    <f:convertNumber maxFractionDigits="2" />>
                                </h:inputText>
                                <h:message for="instalment" errorClass="invalid" id="instalmentMessage" />
                            </div>  

                            <div class="marginT10" > 
                                <h:outputText class="dialogLabel" value="Okres spłaty (w miesiącach)"/>
                                <h:inputText required="true" id="paymentsNumber" class="floatR marginT10"  style="width: 205px" value="#{caseViewMB.selectedClientCase.numberOfPayments}" >
                                    <f:convertNumber integerOnly="true" />
                                    <f:validateLongRange minimum="1" maximum="999" />
                                </h:inputText>
                                <h:message for="paymentsNumber" errorClass="invalid" id="paymentsNumberMessage" />
                            </div>
                            <div>
                                <p:commandButton update="@form" styleClass="floatL wideButton" style="margin-top: 20px !important; clear: right;" type="button" value="Anuluj" onclick="fillFinishedData.hide();"  />
                                <p:commandButton update="@form" styleClass="floatR wideButton" style="margin-top: 20px !important; clear: right;" value="Zakończ sprawę" action="#{caseViewMB.changeCaseStatus(9)}" oncomplete="if (!args.validationFailed){ fillFinishedData.hide(); statusChange.show(); } "   />
                            </div>    
                        </h:form>
                    </p:dialog>

                    <!--COPIED DIALOGS FROM CONSULTANT MAIN PAGE-->  
                    <h:form id="confDialog">
                        <p:dialog id="confirmApplied" dynamic="true" closable="false" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); overflow: hidden; border-radius: 0px;" header="Informacja"  widgetVar="confirmed" resizable="false" height="80" width="440" showEffect="clip" hideEffect="explode" modal="true" >  
                            <h:panelGroup rendered="#{!clientCaseMB.alreadyApplied and !clientCaseMB.notEnoughApplications}" class="fontGrey">
                                Twoje zgłoszenie do sprawy zostało zatwierdzone.
                            </h:panelGroup>

                            <h:panelGroup rendered="#{clientCaseMB.notEnoughApplications}" class="fontGrey">
                                Limit zgłoszeń został wyczerpany! Wykup nowy abonament. 
                            </h:panelGroup>

                            <div> 
                                <h:commandButton id="okBtn1" styleClass="floatR wideButton" style="margin-top:30px;" type="button" value="Kontynuuj" onclick="confirmed.hide()"  >
                                    <f:ajax execute="@this" render=":rightColumn" />
                                </h:commandButton>
                            </div>
                        </p:dialog>

                        <p:dialog id="confirmObserved" dynamic="true" closable="false" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); overflow: hidden; border-radius: 0px;" header="Informacja"  widgetVar="confirmedObserved" resizable="false" height="80" width="440" showEffect="clip" hideEffect="explode" modal="true" >  
                            <h:panelGroup class="fontGrey">
                                Od teraz śledzisz sprawę numer:  #{caseViewMB.selectedClientCase.idClientCase}.
                            </h:panelGroup>

                            <div> 
                                <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" type="button" value="Kontynuuj" onclick="confirmedObserved.hide()"  >
                                    <f:ajax execute="@this" render=":rightColumn" />
                                </h:commandButton>
                            </div>
                        </p:dialog>

                        <p:dialog id="revokeApplication" dynamic="true" closable="false" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); overflow: hidden; border-radius: 0px;" header="Czy napewno?"  widgetVar="revokeApp" resizable="false" height="80" width="440" showEffect="clip" hideEffect="explode" modal="true" >   
                            <h:panelGroup class="fontGrey">
                                Czy napewno chcesz usunąć element z listy?
                            </h:panelGroup>

                            <div> 
                                <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" value="Tak" action="#{clientCaseMB.revokeApplication(caseViewMB.selectedClientCase)}" onclick="revokeApp.hide()" >
                                    <f:ajax execute="@this" render=":rightColumn" />
                                </h:commandButton>

                                <h:commandButton styleClass="floatL wideButton" style="margin-top:30px;" type="button" value="Nie" onclick="revokeApp.hide()"  >

                                </h:commandButton>
                            </div>
                        </p:dialog>

                        <p:dialog id="revokeObserved" dynamic="true" closable="false" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); overflow: hidden; border-radius: 0px;" header="Czy napewno?"  widgetVar="revokeObs" resizable="false" height="80" width="440" showEffect="clip" hideEffect="explode" modal="true" >   
                            <h:panelGroup class="fontGrey">
                                Czy napewno chcesz usunąć element z listy?
                            </h:panelGroup>

                            <div> 
                                <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" type="button"   value="Tak" action="#{clientCaseMB.stopObserve(caseViewMB.selectedClientCase)}" onclick="revokeObs.hide()" >
                                    <f:ajax execute="@this" render=":rightColumn" />
                                </h:commandButton>

                                <h:commandButton styleClass="floatL wideButton" style="margin-top:30px;" type="button" value="Nie" onclick="revokeObs.hide()"  >

                                </h:commandButton>
                            </div>
                        </p:dialog>


                        <p:dialog id="acceptPremiumCase" dynamic="true" closable="false" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); overflow: hidden; border-radius: 0px;" header="Czy napewno?"  widgetVar="acceptPremiumDialog" resizable="false" height="80" width="440" showEffect="clip" hideEffect="explode" modal="true" >   
                            <h:panelGroup class="fontGrey">
                                Czy napewno chcesz zaakceptować sprawę nr #{caseViewMB.selectedClientCase.idClientCase}?
                            </h:panelGroup>

                            <div> 
                                <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" value="Tak" action="#{clientCaseMB.consultantAcceptPremium(caseViewMB.selectedClientCase)}" onclick="acceptPremiumDialog.hide()" >
                                    <f:ajax execute="@this" render=":rightColumn :leftForm" />
                                </h:commandButton>

                                <h:commandButton styleClass="floatL wideButton" style="margin-top:30px;" type="button" value="Nie" onclick="acceptPremiumDialog.hide()"  />
                            </div>
                        </p:dialog>

                        <p:dialog id="revokePremiumCase" dynamic="true" closable="false" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); overflow: hidden; border-radius: 0px;" header="Czy napewno?"  widgetVar="revokePremiumDialog" resizable="false" height="80" width="440" showEffect="clip" hideEffect="explode" modal="true" >   
                            <h:panelGroup class="fontGrey">
                                Czy napewno chcesz odrzucić sprawę nr #{caseViewMB.selectedClientCase.idClientCase}?
                            </h:panelGroup>

                            <div> 
                                <h:commandButton styleClass="floatR wideButton" style="margin-top:30px;" type="button" value="Tak" action="#{clientCaseMB.consultantRevokePremium(caseViewMB.selectedClientCase)}" onclick="revokePremiumDialog.hide()" >          
                                    <f:ajax execute="@this" render=":rightColumn :leftForm" />
                                </h:commandButton>

                                <h:commandButton styleClass="floatL wideButton" style="margin-top:30px;" type="button" value="Nie" onclick="acceptPremiumDialog.hide()"  />
                            </div>
                        </p:dialog>
                    </h:form>            
            </ui:define>
        </ui:composition>
    </body>
</html>  

